	#include "stm32f411xe.h"
	#include "stm32f4xx.h"
	#include <stdint.h>
	#include "string.h"

	uint8_t UART_RX(uint8_t temp);
	int msTicks = 0;
	void delayMs(int ms);

	int main() {
		RCC -> AHB1ENR |= RCC_AHB1ENR_GPIOAEN | RCC_AHB1ENR_GPIOCEN;
		RCC -> APB1ENR |= RCC_APB1ENR_USART2EN;

		// setup board User KEY button
		GPIOA -> MODER &= ~0x03; // Clear MODER0 → PA0 as input
		GPIOA -> PUPDR &= ~0x03; // Clear PUPDR0 bits
		GPIOA -> PUPDR |= 0x01; // Set PUPDR0 = 01 → pull-up

		// setup board LED
		GPIOC -> MODER &= ~(0x03 << (2 * 13)); // Clear MODER13 bits
		GPIOC -> MODER |= 0x01 << (2 * 13); // MODER13 = 01 → PC13 as output

		// setup PA2 USART (TX)
		GPIOA -> MODER &= ~(0x03 << (2 * 2)); // Clear MODER2 bits
		GPIOA -> MODER |= 0x02 << (2 * 2); // MODER13 = 11 → PC2 as alternate function
		GPIOA -> AFR[0] &= ~(0x0F << (4 * 2)); // Clear AFRL2 bits
		GPIOA -> AFR[0] |= 0x07 << (4 * 2); // AFRL2 = 7 (USART2)

		// setup PA3 USART (RX)
		GPIOA -> MODER &= ~(0x03 << (2 * 3)); // Clear MODER3 bits
		GPIOA -> MODER |= 0x02 << (2 * 3); // MODER13 = 11 → PC3 as alternate function
		GPIOA -> AFR[0] &= ~(0x0F << (4 * 3)); // Clear AFRL2 bits
		GPIOA -> AFR[0] |= 0x07 << (4 * 3); // AFRL2 = 7 (USART2)

		char myString[] = "123\r\n";
		uint8_t len = strlen(myString);
		uint8_t count = 0;

		USART2 -> BRR = 0x16C;
		USART2 -> CR1 |= USART_CR1_TE;
		USART2 -> CR1 |= USART_CR1_UE;

		while (1) {
			if (GPIOA->IDR & (1 << 0)) {
				// Button released
				GPIOC->ODR |= (1 << 13);
			} else {
				// Button pressed
				GPIOC->ODR &= ~(1 << 13);

				for (count = 0; count < len; count++) {
					USART2 -> DR = myString[count];
					while ((USART2 -> SR & USART_SR_TC) == 0);
				}
			}
		}
	}
