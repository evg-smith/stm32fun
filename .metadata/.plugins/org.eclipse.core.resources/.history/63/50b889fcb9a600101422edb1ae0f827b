/*
 * lcd_lib.c
 *
 *  Created on: Oct 11, 2025
 *      Author: eevgs
 */
#include "lcd_lib.h"

void write_bits(uint16_t bits) {
	HAL_GPIO_WritePin(GPIOA, RS_Pin, (bits >> 9) && 1);
	HAL_GPIO_WritePin(GPIOA, RW_Pin, (bits >> 8) && 1);

	HAL_GPIO_WritePin(GPIOA, D7_Pin, (bits >> 7) && 1);
	HAL_GPIO_WritePin(GPIOA, D6_Pin, (bits >> 6) && 1);
	HAL_GPIO_WritePin(GPIOA, D5_Pin, (bits >> 5) && 1);
	HAL_GPIO_WritePin(GPIOA, D4_Pin, (bits >> 4) && 1);

	HAL_Delay(1);
	HAL_GPIO_WritePin(GPIOA, EN_Pin, 1);
	HAL_Delay(1);
	HAL_GPIO_WritePin(GPIOA, EN_Pin, 0);
	HAL_Delay(1);

	HAL_GPIO_WritePin(GPIOA, D7_Pin, (bits >> 7) && 1);
	HAL_GPIO_WritePin(GPIOA, D6_Pin, (bits >> 6) && 1);
	HAL_GPIO_WritePin(GPIOA, D5_Pin, (bits >> 5) && 1);
	HAL_GPIO_WritePin(GPIOA, D4_Pin, (bits >> 4) && 1);

	HAL_Delay(1);
	HAL_GPIO_WritePin(GPIOA, EN_Pin, 1);
	HAL_Delay(1);
	HAL_GPIO_WritePin(GPIOA, EN_Pin, 0);
	HAL_Delay(1);
}

void init(void) {
	write_bits(0b00100000); // 4-bit mode
	write_bits(0b00000001); // clear display
	write_bits(0b00000010); // return home
	write_bits(0b00001100); // display on, no coursor
}

void write_char(char c) {
	write_bits((0b10 << 8) | c);
}

void write_string(const char *str) {
    while (*str != '\0') {
        write_char(*str);
        str++;
    }
}
